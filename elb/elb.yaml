AWSTemplateFormatVersion: '2010-09-09'
Description: Elastic Load Balancer
Parameters:
  VPC:
    Type: AWS::EC2::VPC::Id
    Description: Choose which VPC the Application Load Balancer should be deployed
      to
    Default: !Ref 'VPC'
  Subnets:
    Description: Choose which subnets the Application Load Balancer should be deployed
      to
    Type: List<AWS::EC2::Subnet::Id>
    Default: !Ref 'Subnets'
Resources:
  S3BUCKET:
    Type: AWS::S3::Bucket
    DeletionPolicy: Retain
    Properties:
      VersioningConfiguration:
        Status: Enabled
      Tags:
        - Key: created_timestamp
          Value: 1646386202
        - Key: last_modified_timestamp
          Value: 1646386202
        - Key: resource_name
          Value: S3BUCKET
        - Key: resource_type
          Value: AWS::S3::Bucket
        - Key: prancer_unique_id
          Value: 788ad36a-1eaa-49f1-89a2-2e629d7db928
  MyLoadBalancer:
    Type: AWS::ElasticLoadBalancing::LoadBalancer
    Properties:
      AccessLoggingPolicy:
        Enabled: false
        S3BucketName: !Ref 'S3BUCKET'
      CrossZone: false
      Subnets: !Ref 'Subnets'
      ConnectionDrainingPolicy:
        Enabled: false
      Listeners:
        - InstancePort: '80'
          InstanceProtocol: HTTP
          LoadBalancerPort: '443'
          Protocol: HTTPS
          PolicyNames:
            - My-SSLNegotiation-Policy
          SSLCertificateId: arn:aws:iam::123456789012:server-certificate/my-server-certificate
      Policies:
        - PolicyName: My-SSLNegotiation-Policy
          PolicyType: SSLNegotiationPolicyType
          Attributes:
            - Name: DHE-RSA-AES128-SHA
              Value: 'true'
            - Name: DHE-DSS-AES128-SHA
              Value: 'true'
            - Name: CAMELLIA128-SHA
              Value: 'true'
            - Name: EDH-RSA-DES-CBC3-SHA
              Value: 'true'
            - Name: DES-CBC3-SHA
              Value: 'true'
            - Name: ECDHE-RSA-RC4-SHA
              Value: 'true'
            - Name: RC4-SHA
              Value: 'true'
            - Name: ECDHE-ECDSA-RC4-SHA
              Value: 'true'
            - Name: DHE-DSS-AES256-GCM-SHA384
              Value: 'true'
            - Name: DHE-RSA-AES256-GCM-SHA384
              Value: 'true'
            - Name: DHE-RSA-AES256-SHA256
              Value: 'true'
            - Name: DHE-DSS-AES256-SHA256
              Value: 'true'
            - Name: DHE-RSA-AES256-SHA
              Value: 'true'
            - Name: DHE-DSS-AES256-SHA
              Value: 'true'
            - Name: DHE-RSA-CAMELLIA256-SHA
              Value: 'true'
            - Name: DHE-DSS-CAMELLIA256-SHA
              Value: 'true'
            - Name: CAMELLIA256-SHA
              Value: 'true'
            - Name: EDH-DSS-DES-CBC3-SHA
              Value: 'true'
            - Name: DHE-DSS-AES128-GCM-SHA256
              Value: 'true'
            - Name: DHE-RSA-AES128-GCM-SHA256
              Value: 'true'
            - Name: DHE-RSA-AES128-SHA256
              Value: 'true'
            - Name: DHE-DSS-AES128-SHA256
              Value: 'true'
            - Name: DHE-RSA-CAMELLIA128-SHA
              Value: 'true'
            - Name: DHE-DSS-CAMELLIA128-SHA
              Value: 'true'
            - Name: ADH-AES128-GCM-SHA256
              Value: 'true'
            - Name: ADH-AES128-SHA
              Value: 'true'
            - Name: ADH-AES128-SHA256
              Value: 'true'
            - Name: ADH-AES256-GCM-SHA384
              Value: 'true'
            - Name: ADH-AES256-SHA
              Value: 'true'
            - Name: ADH-AES256-SHA256
              Value: 'true'
            - Name: ADH-CAMELLIA128-SHA
              Value: 'true'
            - Name: ADH-CAMELLIA256-SHA
              Value: 'true'
            - Name: ADH-DES-CBC3-SHA
              Value: 'true'
            - Name: ADH-DES-CBC-SHA
              Value: 'true'
            - Name: ADH-RC4-MD5
              Value: 'true'
            - Name: ADH-SEED-SHA
              Value: 'true'
            - Name: DES-CBC-SHA
              Value: 'true'
            - Name: DHE-DSS-SEED-SHA
              Value: 'true'
            - Name: DHE-RSA-SEED-SHA
              Value: 'true'
            - Name: EDH-DSS-DES-CBC-SHA
              Value: 'true'
            - Name: EDH-RSA-DES-CBC-SHA
              Value: 'true'
            - Name: IDEA-CBC-SHA
              Value: 'true'
            - Name: RC4-MD5
              Value: 'true'
            - Name: SEED-SHA
              Value: 'true'
            - Name: DES-CBC3-MD5
              Value: 'true'
            - Name: DES-CBC-MD5
              Value: 'true'
            - Name: RC2-CBC-MD5
              Value: 'true'
            - Name: PSK-AES256-CBC-SHA
              Value: 'true'
            - Name: PSK-3DES-EDE-CBC-SHA
              Value: 'true'
            - Name: KRB5-DES-CBC3-SHA
              Value: 'true'
            - Name: KRB5-DES-CBC3-MD5
              Value: 'true'
            - Name: PSK-AES128-CBC-SHA
              Value: 'true'
            - Name: PSK-RC4-SHA
              Value: 'true'
            - Name: KRB5-RC4-SHA
              Value: 'true'
            - Name: KRB5-RC4-MD5
              Value: 'true'
            - Name: KRB5-DES-CBC-SHA
              Value: 'true'
            - Name: KRB5-DES-CBC-MD5
              Value: 'true'
            - Name: EXP-EDH-RSA-DES-CBC-SHA
              Value: 'true'
            - Name: EXP-EDH-DSS-DES-CBC-SHA
              Value: 'true'
            - Name: EXP-ADH-DES-CBC-SHA
              Value: 'true'
            - Name: EXP-DES-CBC-SHA
              Value: 'true'
            - Name: EXP-RC2-CBC-MD5
              Value: 'true'
            - Name: EXP-KRB5-RC2-CBC-SHA
              Value: 'true'
            - Name: EXP-KRB5-DES-CBC-SHA
              Value: 'true'
            - Name: EXP-KRB5-RC2-CBC-MD5
              Value: 'true'
            - Name: EXP-KRB5-DES-CBC-MD5
              Value: 'true'
            - Name: EXP-ADH-RC4-MD5
              Value: 'true'
            - Name: EXP-RC4-MD5
              Value: 'true'
            - Name: EXP-KRB5-RC4-SHA
              Value: 'true'
            - Name: EXP-KRB5-RC4-MD5
              Value: 'true'
            - Name: Protocol-SSLv3
              Value: 'true'
            - Name: Protocol-TLSv1
              Value: 'true'
            - Name: Protocol-TLSv1.1
              Value: 'true'
      Tags:
        - Key: created_timestamp
          Value: 1646386202
        - Key: last_modified_timestamp
          Value: 1646386202
        - Key: resource_name
          Value: MyLoadBalancer
        - Key: resource_type
          Value: AWS::ElasticLoadBalancing::LoadBalancer
        - Key: prancer_unique_id
          Value: afe576a0-1cac-4c3d-912c-3e98214c1232
  MyLoadBalancerV2:
    Type: AWS::ElasticLoadBalancingV2::LoadBalancer
    Properties:
      LoadBalancerAttributes:
        - Key: access_logs.s3.enabled
          Value: false
      Subnets: !Ref 'Subnets'
      Tags:
        - Key: created_timestamp
          Value: 1646386202
        - Key: last_modified_timestamp
          Value: 1646386202
        - Key: resource_name
          Value: MyLoadBalancerV2
        - Key: resource_type
          Value: AWS::ElasticLoadBalancingV2::LoadBalancer
        - Key: prancer_unique_id
          Value: fec85691-4234-471a-9707-dcb1d55c7bda
  DummyTargetGroupPublic:
    Type: AWS::ElasticLoadBalancingV2::TargetGroup
    Properties:
      HealthCheckIntervalSeconds: 6
      HealthCheckPath: /
      HealthCheckProtocol: HTTP
      HealthCheckTimeoutSeconds: 5
      HealthyThresholdCount: 2
      Name: !Join
        - '-'
        - - !Ref 'AWS::StackName'
          - drop-1
      Port: 80
      Protocol: HTTP
      UnhealthyThresholdCount: 2
      VpcId: !Ref 'VPC'
      Tags:
        - Key: created_timestamp
          Value: 1646386202
        - Key: last_modified_timestamp
          Value: 1646386202
        - Key: resource_name
          Value: DummyTargetGroupPublic
        - Key: resource_type
          Value: AWS::ElasticLoadBalancingV2::TargetGroup
        - Key: prancer_unique_id
          Value: 120c7fd2-f802-4b2d-9cb1-1d23a5878d3a
  PublicLoadBalancerListener:
    Type: AWS::ElasticLoadBalancingV2::Listener
    DependsOn:
      - MyLoadBalancerV2
    Properties:
      DefaultActions:
        - TargetGroupArn: !Ref 'DummyTargetGroupPublic'
          Type: redirect
          RedirectConfig:
            Protocol: http
        - TargetGroupArn: !Ref 'DummyTargetGroupPublic'
          Type: authenticate-cognito
      LoadBalancerArn: !Ref 'MyLoadBalancerV2'
      Port: 80
      Protocol: HTTP
      Tags:
        - Key: created_timestamp
          Value: 1646386202
        - Key: last_modified_timestamp
          Value: 1646386202
        - Key: resource_name
          Value: PublicLoadBalancerListener
        - Key: resource_type
          Value: AWS::ElasticLoadBalancingV2::Listener
        - Key: prancer_unique_id
          Value: d1984821-7871-49cb-b823-8327111fc0e5
